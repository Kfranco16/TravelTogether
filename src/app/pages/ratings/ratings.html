<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-11">
      <!-- SECCIÓN 1: Viajes pendientes de valorar -->
      <div class="fw-bold fs-3 mb-4 text-shadow-black" style="color: #6b46c1">
        Mis viajes pendientes de valorar
      </div>

      @if (pendingRatings.length === 0) {
      <div class="card border-0 rounded-3 mb-4 text-center p-5 shadow-sm">
        <div class="mb-2">No tienes viajes pendientes de valorar.</div>
      </div>
      } @for (trip of pendingRatings; track trip.tripId) {
      <app-trip-rating-card
        [trip]="trip"
        [currentUserId]="currentUserId"
        (rate)="
          openModal(
            $event.tripId,
            $event.userId,
            $event.username,
            $event.avatarUrl,
            $event.isOrganizer
          )
        "
      ></app-trip-rating-card>
      }

      <!-- SECCIÓN 2: Viajes para valorar próximamente -->
      <div class="fw-bold fs-4 mt-5 mb-3 text-shadow-black" style="color: #4b5563">
        Viajes para valorar próximamente
      </div>

      @if (upcomingRatings.length === 0) {
      <div class="card border-0 rounded-3 mb-4 text-center p-5 shadow-sm">
        <div class="mb-2">No tienes viajes próximos.</div>
      </div>
      } @for (trip of upcomingRatings; track trip.tripId) {
      <app-trip-rating-card
        [trip]="trip"
        [currentUserId]="currentUserId"
        (rate)="(null)"
      ></app-trip-rating-card>
      }

      <!-- MODAL DE VALORACIÓN (único) -->
      <div
        class="modal fade"
        id="valoracionModal"
        tabindex="-1"
        aria-labelledby="valoracionLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content rounded-4">
            <div class="modal-header" style="background: #6b46c1">
              <h5 class="modal-title text-white" id="valoracionLabel">
                Valorar a {{ modalRating?.username }}
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="d-flex align-items-center gap-2 mb-3">
                <img
                  [src]="
                    modalRating?.avatarUrl ||
                    'https://img.freepik.com/psd-gratis/ilustracion-3d-avatar-o-perfil-humano_23-2150671142.jpg?semt=ais_hybrid&w=740&q=80'
                  "
                  width="38"
                  height="55"
                  class="rounded-1"
                  alt=""
                  style="object-fit: cover"
                />
                <div class="fw-semibold fs-5">{{ modalRating?.username }}</div>
              </div>
              <div class="mb-2 fw-semibold">Puntuación (del 1 al 5):</div>
              <div class="mb-2" style="font-size: 1.5rem">
                @for (star of [1,2,3,4,5]; track star) {
                <span
                  class="star"
                  [class.text-warning]="star <= modalScore"
                  [class.text-muted]="star > modalScore"
                  style="cursor: pointer"
                  (click)="setModalScore(star)"
                >
                  ★
                </span>
                }
              </div>
              <div class="mb-2 fw-semibold">Valoración:</div>
              <textarea
                class="form-control mb-2"
                rows="2"
                [value]="modalComment"
                (input)="setModalComment($event)"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Cancelar
              </button>
              <button
                type="button"
                class="btn btn-morado"
                (click)="submitModalRating()"
                [disabled]="modalScore === 0"
              >
                Registrar valoración
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
