<section class="tt-profile-wrapper">
  <!-- Encabezado -->
  <header class="tt-profile-header">
    <div class="tt-profile-main position-relative">
      <!-- Botón editar perfil (solo tiene sentido si es tu propio perfil) -->
      <button
        type="button"
        class="tt-profile-edit-btn"
        (click)="goToEditProfile()"
        aria-label="Editar perfil"
      >
        <i class="bi bi-pencil-square"></i>
        <span> Editar perfil</span>
      </button>

      <!-- Bloque foto y acciones -->
      <div class="tt-profile-photo-block">
        <div class="tt-profile-photo-ring">
          <img
            class="tt-photo-img"
            [src]="user?.image || defaultAvatar"
            [alt]="user?.username || 'Foto de perfil'"
          />
        </div>

        <div class="tt-profile-actions">
          <button type="button" class="tt-btn tt-btn-sm tt-btn-danger" (click)="onDeletePhoto()">
            Eliminar foto
          </button>

          <label class="tt-btn tt-btn-sm tt-btn-gradient">
            Subir foto
            <input type="file" accept="image/*" (change)="onUploadPhoto($event)" hidden />
          </label>
        </div>
      </div>

      <!-- Bloque info principal -->
      <div class="tt-profile-main-info">
        <h1 class="tt-profile-name">
          {{ user?.username || 'Tu nombre' }}
        </h1>

        <!-- Rating -->
        <div class="tt-profile-rating">
          <div class="d-flex align-items-center gap-1 text-shadow-black mt-1">
            @if (usuarioValoracion != null) { @for (estrella of getEstrellas(usuarioValoracion);
            track estrella.icon + estrella.color + $index) {
            <i class="bi {{ estrella.icon }} {{ estrella.color }}"></i>
            }
            <span class="ms-2">{{ usuarioValoracion }}</span>
            } @else {
            <span>Aún por valorar</span>
            }
          </div>
        </div>

        <p class="tt-profile-label">Lo que ven tus seguidores</p>

        <h4>Mi biografía</h4>
        <p class="tt-profile-bio">
          {{ user?.bio || 'Mi biografía' }}
        </p>

        <h4>Mis intereses</h4>
        <p class="tt-profile-bio">
          {{ user?.interests || 'Mis intereses' }}
        </p>
      </div>
    </div>
  </header>

  <!-- Stats -->
  <section class="tt-stats-grid">
    <article class="tt-stat-card">
      <div class="tt-stat-icon">
        <i class="bi bi-calendar-event"></i>
      </div>
      <p class="tt-stat-label">Miembro desde</p>
      <p class="tt-stat-value">
        {{ memberSince | date : 'dd-MM-yyyy' : 'es' }}
      </p>
    </article>

    <article class="tt-stat-card">
      <div class="tt-stat-icon">
        <i class="bi bi-geo-alt"></i>
      </div>
      <p class="tt-stat-label">Viajes realizados</p>
      <p class="tt-stat-value">{{ tripsCount ?? 0 }}</p>
    </article>

    <article class="tt-stat-card">
      <div class="tt-stat-icon tt-stat-icon-heart">
        <i class="bi bi-heart"></i>
      </div>
      <p class="tt-stat-label" (click)="goToFavoritesPage()">Viajes en favoritos</p>
      <p class="tt-stat-value">{{ favoritesCount ?? 0 }}</p>
    </article>
  </section>

  <!-- CTA valoraciones -->
  <section class="tt-next-trip-card mb-3">
    <div class="tt-next-trip-left" (click)="goToValorarPage()">
      <h2 class="tt-next-trip-destination">Gestiona tus valoraciones</h2>

      <p class="tt-next-trip-date tt-next-trip-date--muted">
        Revisa qué viajes tienes pendientes de valorar, cuáles están en marcha y en cuáles ya has
        dejado tu opinión a tus compañeros.
      </p>
    </div>

    <div class="tt-next-trip-right justify-content-end">
      <div class="tt-next-trip-badge">
        <p class="tt-next-trip-caption">
          {{ pendingRatingsCount !== null ? 'viajes por valorar' : 'sin valoraciones pendientes' }}
        </p>
      </div>
    </div>
  </section>

  <!-- Próximo viaje -->
  <section class="tt-next-trip-card">
    <div class="tt-next-trip-left d-flex gap-3">
      <div
        class="tt-next-trip-thumb"
        (click)="nextTrip && irADetalleViaje()"
        style="flex-shrink: 0"
      >
        <img
          class="tt-next-trip-thumb-img"
          [src]="nextTrip?.image || nextTrip?.portada || 'images/coverDefault.jpg'"
          [alt]="nextTripDestination || 'Próximo viaje'"
          style="width: 200px; height: 120px; object-fit: cover; border-radius: 8px"
        />
      </div>

      <div>
        <p class="tt-next-trip-label">Mi próximo viaje</p>

        <h2 class="tt-next-trip-destination" (click)="nextTrip && irADetalleViaje()">
          {{ nextTripDestination || 'Aún no tienes un viaje reservado' }}
        </h2>

        @if (nextTripDate) {
        <p class="tt-next-trip-date">
          {{ nextTripDate | date : "d 'de' MMMM, y" : 'es' }}
        </p>
        } @else {
        <p class="tt-next-trip-date tt-next-trip-date--muted">
          Cuando reserves tu próximo viaje aparecerá aquí.
        </p>
        }
      </div>
    </div>

    <div class="tt-next-trip-right">
      <div class="tt-next-trip-badge">
        <p class="tt-next-trip-days">
          {{ daysToNextTrip !== null ? daysToNextTrip : '—' }}
        </p>
        <p class="tt-next-trip-caption">
          {{ daysToNextTrip !== null ? 'días restantes' : 'sin fecha' }}
        </p>
      </div>
    </div>
  </section>
</section>
