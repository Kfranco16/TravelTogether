<section class="tt-panel">
  <header class="tt-panel-header">
    <h2 class="tt-title">Mis favoritos</h2>

    <p class="tt-subtitle-small" *ngIf="!loading && !error && favoritos.length">
      Tienes {{ favoritos.length }} viaje{{ favoritos.length > 1 ? 's' : '' }} guardado{{
        favoritos.length > 1 ? 's' : ''
      }}
      en favoritos.
    </p>
  </header>

  <!-- Estados de carga / error / vacío -->
  <p class="tt-text-muted" *ngIf="loading">Cargando tus favoritos...</p>

  <p class="tt-text-error" *ngIf="!loading && error">
    {{ error }}
  </p>

  <p class="tt-text-muted" *ngIf="!loading && !error && !favoritos.length">
    Aún no tienes viajes en favoritos. Marca con el corazón los viajes que te gusten para verlos
    aquí.
  </p>

  <!-- Grid de favoritos -->
  <div class="tt-favs-grid" *ngIf="hasFavorites()">
    <article class="tt-fav-card" *ngFor="let fav of favoritos; trackBy: trackByFavId">
      <!-- Reutilizamos la card de viaje.
           Si el backend devuelve { trip: {...} } la usamos, si no usamos fav directamente. -->
      <app-card-viaje [trip]="fav.trip || fav"></app-card-viaje>

      <footer class="tt-fav-meta">
        <p class="tt-fav-date">
          Añadido a favoritos
          <ng-container *ngIf="fav.created_at">
            el {{ fav.created_at | date : 'dd/MM/yyyy' }}
          </ng-container>
        </p>

        <button type="button" class="tt-btn tt-btn-danger" (click)="onRemoveFavorite(fav)">
          Quitar
        </button>
      </footer>
    </article>
  </div>

  <!-- Modal personalizado de confirmación -->
  <div class="tt-modal-overlay" *ngIf="showModal">
    <div class="tt-modal">
      <h3>Quitar de favoritos</h3>
      <p>¿Seguro que quieres eliminar este viaje de tus favoritos?</p>

      <div class="tt-modal-buttons">
        <button class="tt-btn tt-btn-secondary" (click)="cancelRemove()">Anular</button>
        <button class="tt-btn tt-btn-primary" (click)="confirmRemove()">Confirmar</button>
      </div>
    </div>
  </div>
</section>
