<section class="tt-profile-wrapper">
  <!-- Encabezado -->
  <header class="tt-profile-header">
    <div class="tt-profile-main">
      <div class="tt-profile-photo-block">
        <div class="tt-profile-photo-ring">
          <img
            class="tt-photo-img"
            [src]="user?.image || defaultAvatar"
            alt="{{ user?.username || 'Foto de perfil' }}"
          />
        </div>

        <!-- Botones solo si es tu propio perfil -->
        @if (isOwnProfile) {
        <div class="tt-profile-actions">
          <button type="button" class="tt-btn tt-btn-sm tt-btn-danger" (click)="onDeletePhoto()">
            Eliminar foto
          </button>

          <label class="tt-btn tt-btn-sm tt-btn-gradient">
            Subir foto
            <input type="file" accept="image/*" (change)="onUploadPhoto($event)" hidden />
          </label>
        </div>
        }
      </div>

      <!-- Bloque info principal -->
      <div class="tt-profile-main-info">
        <h1 class="tt-profile-name">
          {{ user?.username || 'Tu nombre' }}
        </h1>

        <!-- Frase pública -->
        <p class="tt-profile-tagline">
          @if (isOwnProfile) {
          <input
            type="text"
            class="tt-tagline-input"
            [(ngModel)]="publicTagline"
            placeholder="Escribe una frase corta sobre ti"
          />
          } @else {
          {{ publicTagline || 'Este viajero aún no ha escrito una presentación.' }}
          }
        </p>

        <!-- Rating -->
        <div class="tt-profile-rating">
          <div class="tt-stars">
            @for (star of stars; track star) {
            <i
              class="bi"
              [ngClass]="
                averageStars >= star ? 'bi-star-fill tt-star-full' : 'bi-star tt-star-empty'
              "
            ></i>
            }
          </div>

          <div class="tt-rating-text">
            <span class="tt-rating-score"> {{ averageScore | number : '1.1-1' }} / 5</span>
            <span class="tt-rating-count"> ({{ ratingCount || 0 }} valoraciones) </span>
          </div>
        </div>

        <!-- Texto pequeño -->
        <p class="tt-profile-label">Lo que ven tus seguidores</p>

        <!-- Bio -->
        <p class="tt-profile-bio">
          {{ user?.bio || 'Soy un viajero apasionado por descubrir el mundo.' }}
        </p>
      </div>
    </div>
  </header>

  <!-- Tarjeta: próximo viaje -->
  <section class="tt-next-trip-card">
    <div class="tt-next-trip-left">
      <p class="tt-next-trip-label">Tu próximo viaje</p>

      <h2 class="tt-next-trip-destination">
        {{ nextTripDestination || 'Aún no tienes un viaje reservado' }}
      </h2>

      @if (nextTripDate) {
      <p class="tt-next-trip-date">
        {{ nextTripDate | date : "d 'de' MMMM, y" : 'es' }}
      </p>
      } @else {
      <p class="tt-next-trip-date tt-next-trip-date--muted">
        Cuando reserves tu próximo viaje aparecerá aquí.
      </p>
      }
    </div>

    <div class="tt-next-trip-right">
      <div class="tt-next-trip-badge">
        <p class="tt-next-trip-days">
          {{ daysToNextTrip !== null ? daysToNextTrip : '—' }}
        </p>
        <p class="tt-next-trip-caption">
          {{ daysToNextTrip !== null ? 'días restantes' : 'sin fecha' }}
        </p>
      </div>
    </div>
  </section>

  <!-- Tarjetas resumen -->
  <section class="tt-stats-grid">
    <article class="tt-stat-card">
      <div class="tt-stat-icon"><i class="bi bi-calendar-event"></i></div>
      <p class="tt-stat-label">Miembro desde</p>
      <p class="tt-stat-value">
        {{ memberSince ? (memberSince | date : "d 'de' MMMM, y" : 'es') : '—' }}
      </p>
    </article>

    <article class="tt-stat-card">
      <div class="tt-stat-icon"><i class="bi bi-geo-alt"></i></div>
      <p class="tt-stat-label">Viajes realizados</p>
      <p class="tt-stat-value">{{ tripsCount ?? 0 }}</p>
    </article>

    <article class="tt-stat-card">
      <div class="tt-stat-icon tt-stat-icon-heart">
        <i class="bi bi-heart"></i>
      </div>
      <p class="tt-stat-label">Viajes en favoritos</p>
      <p class="tt-stat-value">{{ favoritesCount ?? 0 }}</p>
    </article>
  </section>
</section>
